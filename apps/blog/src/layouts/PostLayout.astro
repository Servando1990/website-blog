---
import Layout from './Layout.astro';
import TableOfContents from '../components/TableOfContents.astro';
import { formatDate } from '../utils/dates';

export interface Props {
  title: string;
  date: Date;
  description: string;
  categories: string[];
  readingTime?: string;
  headings?: Array<{
    depth: number;
    slug: string;
    text: string;
  }>;
  image?: string;
}

const { title, date, description, categories, readingTime, headings = [], image } = Astro.props;

// Generate OG image URL if no custom image is provided
const ogImageUrl = image || `/api/og/${Astro.params.slug}.png`;
---

<Layout 
  title={title} 
  description={description}
  ogType="article"
  ogUrl={Astro.url.href}
  ogImage={ogImageUrl}
>
  <div class="flex gap-8 items-start flex-col xl:flex-row">
    {headings.length > 0 && <TableOfContents headings={headings} />}

    <article class="max-w-[700px] mx-auto">
      <header class="mb-8 pb-6 border-b border-border">
        <h1
          class="text-4xl md:text-5xl font-bold mb-4 leading-tight text-foreground"
        >
          {title}
        </h1>
        <div class="text-muted-foreground text-sm mb-4 flex items-center gap-3">
          <time datetime={date.toISOString()}>
            {formatDate(date)}
          </time>
          {readingTime && (
            <>
              <span>·</span>
              <span>{readingTime}</span>
            </>
          )}
        </div>
        {
          categories.length > 0 && (
            <div class="flex gap-3 flex-wrap">
              {categories.map(category => (
                <a
                  href={`/categories/${category.toLowerCase()}`}
                  class="bg-secondary text-secondary-foreground px-3 py-1 rounded-full text-xs font-medium border border-border hover:bg-accent hover:text-accent-foreground transition-all duration-200"
                >
                  {category}
                </a>
              ))}
            </div>
          )
        }
      </header>

      <div class="prose prose-lg dark:prose-invert prose-none-max-w">
        <slot />
      </div>

      <nav class="mt-12 pt-8 border-t border-border">
        <a
          href="/posts"
          class="inline-flex items-center gap-2 text-foreground hover:text-primary font-medium transition-all duration-200 hover:transform hover:-translate-x-1"
          >← Back to all posts</a
        >
      </nav>
    </article>
  </div>
</Layout>

<style>
  /* Ensure headings have proper IDs for anchor linking */
  .prose h1,
  .prose h2,
  .prose h3,
  .prose h4,
  .prose h5,
  .prose h6 {
    scroll-margin-top: 2rem;
    position: relative;
  }

  /* Add hover effect for heading anchors */
  .prose h1:hover::before,
  .prose h2:hover::before,
  .prose h3:hover::before,
  .prose h4:hover::before,
  .prose h5:hover::before,
  .prose h6:hover::before {
    content: '#';
    position: absolute;
    left: -1.5rem;
    opacity: 0.7;
    font-weight: normal;
  }

  /* Override prose default max-width */
  .prose-none-max-w {
    max-width: none !important;
  }
</style>
