---
import Layout from './Layout.astro';
import TableOfContents from '../components/TableOfContents.astro';
import { formatDate } from '../utils/dates';

export interface Props {
  title: string;
  date: Date;
  description: string;
  categories: string[];
  headings?: Array<{
    depth: number;
    slug: string;
    text: string;
  }>;
}

const { title, date, description, categories, headings = [] } = Astro.props;
---

<Layout title={title} description={description}>
  <div class="flex gap-8 items-start flex-col xl:flex-row">
    {headings.length > 0 && <TableOfContents headings={headings} />}

    <article class="flex-1 min-w-0">
      <header class="mb-8 pb-6 border-b border-surface-700">
        <h1
          class="text-4xl md:text-5xl font-bold mb-4 leading-tight text-surface-50"
        >
          {title}
        </h1>
        <div class="text-surface-300 text-sm mb-4">
          <time datetime={date.toISOString()}>
            {formatDate(date)}
          </time>
        </div>
        {
          categories.length > 0 && (
            <div class="flex gap-3 flex-wrap">
              {categories.map(category => (
                <a
                  href={`/categories/${category.toLowerCase()}`}
                  class="bg-surface-800 text-surface-50 px-3 py-1 rounded-full text-xs font-medium border border-surface-700 hover:bg-accent-500 hover:text-white transition-all duration-200"
                >
                  {category}
                </a>
              ))}
            </div>
          )
        }
      </header>

      <div class="prose prose-lg max-w-none text-surface-50">
        <slot />
      </div>

      <nav class="mt-12 pt-8 border-t border-surface-700">
        <a
          href="/posts"
          class="inline-flex items-center gap-2 text-surface-50 hover:text-accent-400 font-medium transition-all duration-200 hover:transform hover:-translate-x-1"
          >‚Üê Back to all posts</a
        >
      </nav>
    </article>
  </div>
</Layout>

<style>
  /* Ensure headings have proper IDs for anchor linking */
  .prose h1,
  .prose h2,
  .prose h3,
  .prose h4,
  .prose h5,
  .prose h6 {
    scroll-margin-top: 2rem;
    position: relative;
    color: #fdfbd4; /* Cream color for all headings */
  }

  /* Add hover effect for heading anchors */
  .prose h1:hover::before,
  .prose h2:hover::before,
  .prose h3:hover::before,
  .prose h4:hover::before,
  .prose h5:hover::before,
  .prose h6:hover::before {
    content: '#';
    position: absolute;
    left: -1.5rem;
    color: #84b067; /* Sage green for anchor symbols */
    font-weight: normal;
    opacity: 0.7;
  }

  /* Ensure all prose content is cream colored */
  .prose p,
  .prose li,
  .prose blockquote,
  .prose strong,
  .prose em,
  .prose code {
    color: #fdfbd4 !important; /* Cream color for all text */
  }

  /* Links in prose should be slightly green but subtle */
  .prose a {
    color: #a7d193 !important; /* Light sage green for links */
  }

  .prose a:hover {
    color: #84b067 !important; /* Darker sage green on hover */
  }
</style>
